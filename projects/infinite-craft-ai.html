<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Infinite Craft Visualizer – CatSu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- your site’s main stylesheet -->
  <link rel="stylesheet" href="https://catsu-osm.github.io/styles.css" />

  <style>
    /* Page-level tweaks so it’s not “crazy” */
    body {
      background: #f4f4f4;
      min-height: 100vh;
    }
    header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #fff;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #ddd;
    }
    header a {
      text-decoration: none;
      color: inherit;
    }
    .page-title {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(280px, 360px) 1fr;
      gap: 1rem;
      padding: 1rem;
    }

    /* left panel: all elements */
    .panel {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 60vh;
    }
    .panel h2 {
      margin: 0;
      padding: 0.75rem 0.75rem 0.5rem;
      border-bottom: 1px solid #eee;
      font-size: 1rem;
    }
    .panel small {
      display: block;
      padding: 0 0.75rem 0.5rem;
      color: #666;
      border-bottom: 1px solid #eee;
    }
    .search-box {
      padding: 0.75rem;
      border-bottom: 1px solid #eee;
    }
    .search-box input {
      width: 100%;
      padding: 0.35rem 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .elements-list {
      flex: 1;
      overflow-y: auto;
      max-height: calc(100vh - 200px);
    }
    .element-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.45rem 0.75rem;
      border-bottom: 1px solid #f2f2f2;
      cursor: pointer;
      gap: 0.5rem;
    }
    .element-row:hover {
      background: #f8fafc;
    }
    .el-name {
      flex: 1;
      font-size: 0.9rem;
    }
    .badge {
      display: inline-block;
      font-size: 0.6rem;
      text-transform: uppercase;
      background: #e2e8f0;
      color: #1e293b;
      padding: 2px 6px;
      border-radius: 6px;
      letter-spacing: 0.03em;
      white-space: nowrap;
    }
    .badge-base {
      background: #dcfce7;
      color: #166534;
    }
    .inventory-pill {
      font-size: 0.65rem;
      background: #0ea5e9;
      color: #fff;
      padding: 2px 6px;
      border-radius: 999px;
      white-space: nowrap;
    }
    .element-row.in-inventory {
      background: #e0f2fe;
    }

    /* right panel: craftable / details */
    .right {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    .card h2 {
      margin: 0;
      padding: 0.75rem 0.75rem 0.5rem;
      border-bottom: 1px solid #eee;
      font-size: 1rem;
    }
    .card-body {
      padding: 0.75rem;
    }
    .craftable-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.75rem;
    }
    .craftable-item {
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 0.5rem 0.55rem 0.5rem;
      background: #f8fafc;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .craftable-name {
      font-weight: 600;
      font-size: 0.9rem;
    }
    .recipe-line {
      font-size: 0.7rem;
      color: #475569;
    }
    .recipe-line strong {
      font-weight: 600;
    }
    .empty-state {
      font-size: 0.85rem;
      color: #666;
    }

    .inventory-list-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }
    .inventory-chip {
      background: #0f172a;
      color: #fff;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .elements-list {
        max-height: 300px;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="https://catsu-osm.github.io/">← Back</a>
    <span class="page-title">Infinite Craft Visualizer</span>
  </header>

  <main class="layout">
    <!-- LEFT: all elements -->
    <section class="panel" id="all-elements-panel">
      <h2>All Elements</h2>
      <small>Click to toggle in/out of inventory.</small>
      <div class="search-box">
        <input type="text" id="element-search" placeholder="Filter elements…" />
      </div>
      <div class="elements-list" id="elements-list">
        <!-- filled by JS -->
      </div>
    </section>

    <!-- RIGHT: inventory + craftables -->
    <section class="right">
      <div class="card">
        <h2>Your inventory</h2>
        <div class="card-body" id="inventory-body">
          <p class="empty-state">Nothing selected yet. Click elements on the left to add them.</p>
        </div>
      </div>

      <div class="card">
        <h2>Craftable right now</h2>
        <div class="card-body" id="craftable-body">
          <p class="empty-state">Pick at least one element to see results.</p>
        </div>
      </div>

      <div class="card">
        <h2>All elements (raw JSON)</h2>
        <div class="card-body">
          <p style="font-size:0.7rem;color:#94a3b8">Loaded from <code>docs/infinite_craft_recipes.json</code>.</p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // adjust this if your HTML is in /projects/ and JSON is in /docs/
    const RECIPES_URL = '../docs/infinite_craft_recipes.json';

    // state
    let recipes = {};
    let sortedNames = [];
    let inventory = new Set();

    // helper: is base
    function isBase(name) {
      const node = recipes[name];
      return node && node._base === true;
    }

    // helper: get recipes for element
    function getRecipeOptions(name) {
      const node = recipes[name];
      if (!node) return [];
      if (Array.isArray(node.recipes)) {
        return node.recipes;
      }
      return [];
    }

    // can we make "target" with current inventory?
    function canMakeWithInventory(target, invSet) {
      const opts = getRecipeOptions(target);
      if (!opts.length) return false;

      // target already in inventory -> we don't need to "make" it
      if (invSet.has(target)) return false;

      // if any option is fully satisfied by inventory -> craftable
      for (const opt of opts) {
        let ok = true;
        for (const ing of opt) {
          if (!invSet.has(ing)) {
            ok = false;
            break;
          }
        }
        if (ok) return true;
      }
      return false;
    }

    function renderElements(filterText = '') {
      const list = document.getElementById('elements-list');
      list.innerHTML = '';
      const ft = filterText.trim().toLowerCase();
      for (const name of sortedNames) {
        if (ft && !name.toLowerCase().includes(ft)) continue;
        const row = document.createElement('div');
        row.className = 'element-row' + (inventory.has(name) ? ' in-inventory' : '');
        row.dataset.name = name;

        const left = document.createElement('div');
        left.className = 'el-name';
        left.textContent = name;
        row.appendChild(left);

        const badge = document.createElement('span');
        badge.className = 'badge' + (isBase(name) ? ' badge-base' : '');
        badge.textContent = isBase(name) ? 'base' : 'craftable';
        row.appendChild(badge);

        if (inventory.has(name)) {
          const inv = document.createElement('span');
          inv.className = 'inventory-pill';
          inv.textContent = 'in inventory';
          row.appendChild(inv);
        }

        row.addEventListener('click', () => {
          if (inventory.has(name)) {
            inventory.delete(name);
          } else {
            inventory.add(name);
          }
          renderInventory();
          renderCraftables();
          renderElements(document.getElementById('element-search').value || '');
        });

        list.appendChild(row);
      }
    }

    function renderInventory() {
      const body = document.getElementById('inventory-body');
      body.innerHTML = '';
      if (inventory.size === 0) {
        body.innerHTML = '<p class="empty-state">Nothing selected yet. Click elements on the left to add them.</p>';
        return;
      }
      const wrap = document.createElement('div');
      wrap.className = 'inventory-list-inline';
      Array.from(inventory).sort((a,b)=>a.localeCompare(b)).forEach(name => {
        const chip = document.createElement('span');
        chip.className = 'inventory-chip';
        chip.textContent = name;
        wrap.appendChild(chip);
      });
      body.appendChild(wrap);
    }

    function renderCraftables() {
      const body = document.getElementById('craftable-body');
      body.innerHTML = '';
      if (inventory.size === 0) {
        body.innerHTML = '<p class="empty-state">Pick at least one element to see results.</p>';
        return;
      }

      const craftables = [];
      for (const name of sortedNames) {
        if (canMakeWithInventory(name, inventory)) {
          craftables.push(name);
        }
      }

      if (!craftables.length) {
        body.innerHTML = '<p class="empty-state">No elements can be crafted from exactly what you have. Try adding more.</p>';
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'craftable-grid';

      for (const el of craftables) {
        const card = document.createElement('div');
        card.className = 'craftable-item';
        const title = document.createElement('div');
        title.className = 'craftable-name';
        title.textContent = el;
        card.appendChild(title);

        // show ONLY the recipes that match inventory
        const opts = getRecipeOptions(el);
        for (const opt of opts) {
          const ok = opt.every(ing => inventory.has(ing));
          if (!ok) continue;
          const line = document.createElement('div');
          line.className = 'recipe-line';
          line.innerHTML = `<strong>${el}</strong> = ${opt.join(' + ')}`;
          card.appendChild(line);
        }

        grid.appendChild(card);
      }

      body.appendChild(grid);
    }

    async function init() {
      try {
        const res = await fetch(RECIPES_URL);
        const data = await res.json();
        recipes = data || {};
        sortedNames = Object.keys(recipes).sort((a,b)=>a.localeCompare(b));
        renderElements();
      } catch (err) {
        console.error('Failed to load recipes:', err);
        document.getElementById('elements-list').innerHTML =
          '<p style="padding:1rem;color:#b91c1c;">Could not load docs/infinite_craft_recipes.json</p>';
      }
    }

    document.getElementById('element-search').addEventListener('input', (e) => {
      renderElements(e.target.value);
    });

    init();
  </script>
</body>
</html>
